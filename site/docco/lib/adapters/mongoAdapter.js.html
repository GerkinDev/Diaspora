---
layout: doccopage
title: "mongoAdapter.js"
toc: false
---
<div id="container"><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>mongoAdapter.js</h1><div class="filepath">lib/adapters/mongoAdapter.js</div></th><th class="code"></th></tr></thead><tbody><tr class="section" id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span></span><span id="line-1"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span id="line-2">
</span><span id="line-3"><span class="kr">const</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;lodash&#39;</span> <span class="p">);</span>
</span><span id="line-4"><span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;check-types&#39;</span> <span class="p">);</span>
</span><span id="line-5"><span class="kr">const</span> <span class="nb">Promise</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;bluebird&#39;</span> <span class="p">);</span>
</span><span id="line-6"><span class="kr">const</span> <span class="nx">MongoClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;mongodb&#39;</span> <span class="p">).</span><span class="nx">MongoClient</span><span class="p">;</span>
</span><span id="line-7"><span class="kr">const</span> <span class="nx">DiasporaAdapter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;./baseAdapter.js&#39;</span> <span class="p">);</span>
</span><span id="line-8"><span class="kr">const</span> <span class="nx">MongoEntity</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;../dataStoreEntities/mongoEntity.js&#39;</span> <span class="p">);</span>
</span><span id="line-9">
</span><span id="line-10">
</span><span id="line-11"></pre></div></td></tr><tr class="section" id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Class <em>MongoDiasporaAdapter</em></div><div class="dox_tag_detail">This class is used to use local storage or session storage as a data store. This adapter should be used only by Node.JS</div><div class="dox_tag_title">extends</div><div class="dox_tag_detail">{&quot;type&quot;:&quot;extends&quot;,&quot;string&quot;:&quot;Adapters.DiasporaAdapter&quot;,&quot;otherClass&quot;:&quot;Adapters.DiasporaAdapter&quot;,&quot;html&quot;:&quot;&lt;p&gt;Adapters.DiasporaAdapter&lt;/p&gt;&quot;}</div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Create a new Mongo data store</p></div><div class="dox_tag_title">In: <em>Adapters</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>config </span><span class="dox_type">Object</span><span>- <p>Options hash.</p></span></div><div class="dox_tag_detail"> <span>config.database </span><span class="dox_type">String</span><span>- <p>Name of the database</p></span></div><div class="dox_tag_detail"> <span>config.host='localhost' </span><span class="dox_type">String</span><span>- <p>Host address of the target MongoDB instance</p></span></div><div class="dox_tag_detail"> <span>config.port=27017 </span><span class="dox_type">Integer</span><span>- <p>Port of the target MongoDB instance</p></span></div><div class="dox_tag_detail"> <span>config.username=false </span><span class="dox_type">String</span><span>- <p>Username used to connect.</p></span></div><div class="dox_tag_detail"> <span>config.password=false </span><span class="dox_type">String</span><span class="dox_type">Boolean</span><span>- <p>Password used to connect. Set to false to disable password authentication</p></span></div><div class="dox_tag_title">Scope: <span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-12"><span class="kr">class</span> <span class="nx">MongoDiasporaAdapter</span> <span class="kr">extends</span> <span class="nx">DiasporaAdapter</span> <span class="p">{</span>
</span><span id="line-13">    <span class="nx">constructor</span><span class="p">(</span> <span class="nx">config</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-14">        <span class="kr">super</span><span class="p">(</span> <span class="nx">MongoEntity</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-15">            <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;_id&#39;</span><span class="p">,</span>
</span><span id="line-16">        <span class="p">},</span> <span class="p">{</span>
</span><span id="line-17">            <span class="nx">input</span><span class="o">:</span> <span class="p">{</span>
</span><span id="line-18">                <span class="nx">id</span><span class="o">:</span> <span class="nx">val</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;mongodb&#39;</span> <span class="p">).</span><span class="nx">ObjectID</span><span class="p">(</span> <span class="nx">val</span> <span class="p">),</span>
</span><span id="line-19">            <span class="p">},</span>
</span><span id="line-20">            <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span><span id="line-21">                <span class="nx">_id</span><span class="o">:</span> <span class="nx">val</span> <span class="p">=&gt;</span> <span class="nx">val</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
</span><span id="line-22">            <span class="p">},</span>
</span><span id="line-23">        <span class="p">});</span>
</span><span id="line-24">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span> <span class="s1">&#39;database&#39;</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-25">            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="s1">&#39;Missing required string parameter &quot;database&quot;.&#39;</span> <span class="p">);</span>
</span><span id="line-26">        <span class="p">}</span>
</span><span id="line-27">
</span><span id="line-28"></pre></div></td></tr><tr class="section" id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><h3>TODO</h3>

<p>Support proxies (<a href="http://mongodb.github.io/node-mongodb-native/2.2/reference/connecting/legacy-connection-settings/#mongos-proxy-connection">see MongoDB Driver doc</a>)</p></td><td class="code"><div class="highlight"><pre></span><span id="line-29">        <span class="kr">const</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-30">            <span class="nx">host</span><span class="o">:</span>     <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
</span><span id="line-31">            <span class="nx">port</span><span class="o">:</span>     <span class="mi">27017</span><span class="p">,</span>
</span><span id="line-32">            <span class="nx">password</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span id="line-33">            <span class="nx">username</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span id="line-34">        <span class="p">};</span>
</span><span id="line-35">        <span class="kr">const</span> <span class="nx">ORMKeys</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span> <span class="nx">defaults</span> <span class="p">),</span> <span class="p">[</span> <span class="s1">&#39;database&#39;</span> <span class="p">]);</span>
</span><span id="line-36">        <span class="kr">const</span> <span class="nx">otherProps</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">omit</span><span class="p">(</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">ORMKeys</span> <span class="p">);</span>
</span><span id="line-37">        <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">defaults</span> <span class="p">);</span>
</span><span id="line-38">        <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
</span><span id="line-39">
</span><span id="line-40">        <span class="kr">const</span> <span class="nx">authPrefix</span> <span class="o">=</span> <span class="p">(</span> <span class="kc">false</span> <span class="o">!==</span> <span class="nx">config</span><span class="p">.</span><span class="nx">username</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span> <span class="nx">config</span><span class="p">.</span><span class="nx">username</span> <span class="o">+</span> <span class="p">(</span> <span class="kc">false</span> <span class="o">!==</span> <span class="nx">config</span><span class="p">.</span><span class="nx">password</span> <span class="o">?</span> <span class="sb">`:</span><span class="si">${</span>  <span class="nx">config</span><span class="p">.</span><span class="nx">password</span> <span class="si">}</span><span class="sb">`</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>  <span class="si">}</span><span class="sb">@`</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">);</span>
</span><span id="line-41">
</span><span id="line-42"></pre></div></td></tr><tr class="section" id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Connection URL</p></td><td class="code"><div class="highlight"><pre></span><span id="line-43">        <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`mongodb://</span><span class="si">${</span> <span class="nx">authPrefix</span> <span class="si">}${</span> <span class="nx">config</span><span class="p">.</span><span class="nx">host</span> <span class="si">}</span><span class="sb">:</span><span class="si">${</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span> <span class="si">}</span><span class="sb">/</span><span class="si">${</span> <span class="nx">config</span><span class="p">.</span><span class="nx">database</span> <span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="line-44">
</span><span id="line-45">
</span><span id="line-46"></pre></div></td></tr><tr class="section" id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Use connect method to connect to the server</p></td><td class="code"><div class="highlight"><pre></span><span id="line-47">        <span class="nx">MongoClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">otherProps</span><span class="p">,</span> <span class="p">(</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">db</span> <span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-48">            <span class="k">if</span> <span class="p">(</span> <span class="nx">c</span><span class="p">.</span><span class="nx">assigned</span><span class="p">(</span> <span class="nx">err</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-49">                <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="nx">err</span> <span class="p">));</span>
</span><span id="line-50">            <span class="p">}</span>
</span><span id="line-51">            <span class="k">this</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="nx">db</span><span class="p">;</span>
</span><span id="line-52">            <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span> <span class="s1">&#39;ready&#39;</span> <span class="p">);</span>
</span><span id="line-53">        <span class="p">});</span>
</span><span id="line-54">    <span class="p">}</span>
</span><span id="line-55">
</span><span id="line-56">
</span><span id="line-57"></pre></div></td></tr><tr class="section" id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><hr />

<h3>Utils</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-58">
</span><span id="line-59">    <span class="nx">close</span><span class="p">()</span> <span class="p">{</span>
</span><span id="line-60">        <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="line-61">        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="s1">&#39;disconnected&#39;</span><span class="p">;</span>
</span><span id="line-62">    <span class="p">}</span>
</span><span id="line-63">
</span><span id="line-64">
</span><span id="line-65"></pre></div></td></tr><tr class="section" id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><hr />

<h3>Insert</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-66">
</span><span id="line-67">
</span><span id="line-68"></pre></div></td></tr><tr class="section" id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>insertOne</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#insertOne}, modified for MongoDB.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Insert a single entity in the memory store.</p></div><div class="dox_tag_title">In: <em>Adapters.MongoDiasporaAdapter</em></div><div class="dox_tag_title">See</div><div class="dox_tag_detail"><a href="#{tag.url"><http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#insertOne> </http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#insertOne></a></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the collection to insert data in</p></span></div><div class="dox_tag_detail"> <span>entity </span><span class="dox_type">Object</span><span>- <p>Hash representing the entity to insert</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once insertion is done. Called with (<em>{@link MongoEntity}</em> <code>entity</code>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-69">    <span class="nx">insertOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">entity</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-70">        <span class="nx">entity</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">pickBy</span><span class="p">(</span> <span class="nx">entity</span><span class="p">,</span> <span class="nx">v</span> <span class="p">=&gt;</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">v</span> <span class="p">);</span>
</span><span id="line-71">        <span class="kr">const</span> <span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-72">        <span class="nx">entity</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">remapInput</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">entity</span> <span class="p">);</span>
</span><span id="line-73">        <span class="k">return</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-74">            <span class="kr">const</span> <span class="nx">newDoc</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span> <span class="nx">res</span><span class="p">.</span><span class="nx">ops</span> <span class="p">);</span>
</span><span id="line-75">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span>
</span><span id="line-76">                <span class="nx">table</span><span class="p">,</span>
</span><span id="line-77">                <span class="p">{</span>
</span><span id="line-78">                    <span class="nx">_id</span><span class="o">:</span> <span class="nx">newDoc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> 
</span><span id="line-79">                <span class="p">},</span>
</span><span id="line-80">                <span class="p">{</span>
</span><span id="line-81">                    <span class="s1">&#39;$set&#39;</span><span class="o">:</span> <span class="p">{</span>
</span><span id="line-82">                        <span class="nx">idHash</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">newDoc</span><span class="p">.</span><span class="nx">idHash</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-83">                            <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span><span class="o">:</span> <span class="nx">newDoc</span><span class="p">.</span><span class="nx">_id</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
</span><span id="line-84">                        <span class="p">}),</span>
</span><span id="line-85">                    <span class="p">},</span>
</span><span id="line-86">                <span class="p">},</span>
</span><span id="line-87">                <span class="p">{</span>
</span><span id="line-88">                    <span class="nx">remapInput</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> 
</span><span id="line-89">                <span class="p">}</span>
</span><span id="line-90">            <span class="p">);</span>
</span><span id="line-91">        <span class="p">});</span>
</span><span id="line-92">    <span class="p">}</span>
</span><span id="line-93">
</span><span id="line-94">
</span><span id="line-95"></pre></div></td></tr><tr class="section" id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><hr />

<h3>Find</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-96">
</span><span id="line-97">
</span><span id="line-98"></pre></div></td></tr><tr class="section" id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>findOne</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#findOne}, modified for MongoDB.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Retrieve a single entity from the local storage.</p></div><div class="dox_tag_title">In: <em>Adapters.MongoDiasporaAdapter</em></div><div class="dox_tag_title">See</div><div class="dox_tag_detail"><a href="#{tag.url"><http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#findOne> </http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#findOne></a></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the model to retrieve data from</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing the entity to find</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once item is found. Called with (<em>{@link InMemoryEntity}</em> <code>entity</code>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-99">    <span class="nx">findOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-100">        <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizeOptions</span><span class="p">(</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-101">        <span class="k">if</span> <span class="p">(</span> <span class="kc">true</span> <span class="o">===</span> <span class="nx">options</span><span class="p">.</span><span class="nx">remapInput</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-102">            <span class="nx">queryFind</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">remapInput</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span> <span class="p">);</span>
</span><span id="line-103">        <span class="p">}</span>
</span><span id="line-104">        <span class="nx">queryFind</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizeQuery</span><span class="p">(</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-105">
</span><span id="line-106"></pre></div></td></tr><tr class="section" id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Create a new query object</p></td><td class="code"><div class="highlight"><pre></span><span id="line-107">        <span class="kr">const</span> <span class="nx">redefinedQueryFind</span> <span class="o">=</span> <span class="p">{};</span>
</span><span id="line-108">        <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="p">(</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">key</span> <span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-109">            <span class="k">if</span> <span class="p">(</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="nx">val</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-110">                <span class="nx">redefinedQueryFind</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-111">                    <span class="nx">$exists</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span id="line-112">                <span class="p">};</span>
</span><span id="line-113">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="line-114">                <span class="nx">redefinedQueryFind</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
</span><span id="line-115">            <span class="p">}</span>
</span><span id="line-116">        <span class="p">});</span>
</span><span id="line-117">        <span class="kr">const</span> <span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-118">        <span class="kd">let</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span> <span class="nx">redefinedQueryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">foundItem</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-119">            <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">remapOutput</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">remapOutput</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">foundItem</span> <span class="p">)</span> <span class="o">:</span> <span class="nx">foundItem</span> <span class="p">);</span>
</span><span id="line-120">        <span class="p">});</span>
</span><span id="line-121">        <span class="k">return</span> <span class="nx">promise</span><span class="p">;</span>
</span><span id="line-122">    <span class="p">}</span>
</span><span id="line-123">
</span><span id="line-124">
</span><span id="line-125">
</span><span id="line-126"></pre></div></td></tr><tr class="section" id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><div class="dox"><div class="summary"><p>findMany( table, queryFind, options = {}) {<br />
        this.ensureTableExists( table );<br />
        const matches = _.filter( storeTable.items, queryFind );<br />
        const reducedMatches = this.constructor.applyOptionsToSet( matches, options );<br />
        return Promise.resolve( _.map( reducedMatches, entity =&gt; new this.classEntity(entity, this )));<br />
    }</p></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-127">
</span><span id="line-128">
</span><span id="line-129"></pre></div></td></tr><tr class="section" id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><hr />

<h3>Update</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-130">
</span><span id="line-131">    <span class="nx">filterUpdateUnset</span><span class="p">(</span> <span class="nx">updateQuery</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-132">        <span class="kr">const</span> <span class="nx">$set</span> <span class="o">=</span> <span class="p">{};</span>
</span><span id="line-133">        <span class="kr">const</span> <span class="nx">$unset</span> <span class="o">=</span> <span class="p">{};</span>
</span><span id="line-134">        <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="nx">updateQuery</span><span class="p">,</span> <span class="p">(</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">key</span> <span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-135">            <span class="k">if</span> <span class="p">(</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">val</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-136">                <span class="nx">$unset</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span id="line-137">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="line-138">                <span class="nx">$set</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
</span><span id="line-139">            <span class="p">}</span>
</span><span id="line-140">        <span class="p">});</span>
</span><span id="line-141">        <span class="kr">const</span> <span class="nx">fullQuery</span> <span class="o">=</span> <span class="p">{};</span>
</span><span id="line-142">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">emptyObject</span><span class="p">(</span> <span class="nx">$unset</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-143">            <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span> <span class="nx">fullQuery</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-144">                <span class="nx">$unset</span><span class="p">,</span>
</span><span id="line-145">            <span class="p">});</span>
</span><span id="line-146">        <span class="p">}</span>
</span><span id="line-147">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">emptyObject</span><span class="p">(</span> <span class="nx">$set</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-148">            <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span> <span class="nx">fullQuery</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-149">                <span class="nx">$set</span><span class="p">,</span>
</span><span id="line-150">            <span class="p">});</span>
</span><span id="line-151">        <span class="p">}</span>
</span><span id="line-152">        <span class="k">return</span> <span class="nx">fullQuery</span><span class="p">;</span>
</span><span id="line-153">    <span class="p">}</span>
</span><span id="line-154">
</span><span id="line-155">
</span><span id="line-156"></pre></div></td></tr><tr class="section" id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>updateOne</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#updateOne}, modified for MongoDB.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Update a single entity.</p></div><div class="dox_tag_title">In: <em>Adapters.MongoDiasporaAdapter</em></div><div class="dox_tag_title">See</div><div class="dox_tag_detail"><a href="#{tag.url"><http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#updateOne> </http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#updateOne></a></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the collection to update data in</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing the entity to find</p></span></div><div class="dox_tag_detail"> <span>update </span><span class="dox_type">Object</span><span>- <p>Object properties to set</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once update is done. Called with (<em>{@link MongoEntity}</em> <code>entity</code>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-157">    <span class="nx">updateOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-158">        <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizeOptions</span><span class="p">(</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-159">        <span class="k">if</span> <span class="p">(</span> <span class="kc">true</span> <span class="o">===</span> <span class="nx">options</span><span class="p">.</span><span class="nx">remapInput</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-160">            <span class="nx">queryFind</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">remapInput</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span> <span class="p">);</span>
</span><span id="line-161">            <span class="nx">update</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">remapInput</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">update</span> <span class="p">);</span>
</span><span id="line-162">            <span class="nx">update</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterUpdateUnset</span><span class="p">(</span> <span class="nx">update</span> <span class="p">);</span>
</span><span id="line-163">        <span class="p">}</span>
</span><span id="line-164">        <span class="nx">queryFind</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizeQuery</span><span class="p">(</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-165">        <span class="kr">const</span> <span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-166">        <span class="kr">const</span> <span class="nx">subOptions</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-167">            <span class="nx">remapInput</span><span class="o">:</span>  <span class="kc">false</span><span class="p">,</span>
</span><span id="line-168">            <span class="nx">remapOutput</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span id="line-169">        <span class="p">});</span>
</span><span id="line-170">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">subOptions</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">foundItem</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-171">            <span class="k">return</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span>
</span><span id="line-172">                <span class="nx">_id</span><span class="o">:</span> <span class="nx">foundItem</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
</span><span id="line-173">            <span class="p">},</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">subOptions</span> <span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">foundItem</span><span class="p">.</span><span class="nx">_id</span> <span class="p">));</span>
</span><span id="line-174">        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">updatedId</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-175">            <span class="nx">_id</span><span class="o">:</span> <span class="nx">updatedId</span><span class="p">,</span>
</span><span id="line-176">        <span class="p">},</span> <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span> <span class="nx">subOptions</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-177">            <span class="nx">remapOutput</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span id="line-178">        <span class="p">})));</span>
</span><span id="line-179">    <span class="p">}</span>
</span><span id="line-180">
</span><span id="line-181">
</span><span id="line-182"></pre></div></td></tr><tr class="section" id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>updateMany</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#updateMany}, modified for MongoDB.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Update several entities.</p></div><div class="dox_tag_title">In: <em>Adapters.MongoDiasporaAdapter</em></div><div class="dox_tag_title">See</div><div class="dox_tag_detail"><a href="#{tag.url"><http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#updateMany> </http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#updateMany></a></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the collection to update data in</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing entities to find</p></span></div><div class="dox_tag_detail"> <span>update </span><span class="dox_type">Object</span><span>- <p>Object properties to set</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once update is done. Called with (<em>{@link MongoEntity}[]</em> <code>entities</code>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-183">    <span class="nx">updateMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-184">        <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizeOptions</span><span class="p">(</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-185">        <span class="k">if</span> <span class="p">(</span> <span class="kc">true</span> <span class="o">===</span> <span class="nx">options</span><span class="p">.</span><span class="nx">remapInput</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-186">            <span class="nx">queryFind</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">remapInput</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span> <span class="p">);</span>
</span><span id="line-187">            <span class="nx">update</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">remapInput</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">update</span> <span class="p">);</span>
</span><span id="line-188">        <span class="p">}</span>
</span><span id="line-189">        <span class="nx">queryFind</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizeQuery</span><span class="p">(</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-190">        <span class="nx">update</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterUpdateUnset</span><span class="p">(</span> <span class="nx">update</span> <span class="p">);</span>
</span><span id="line-191">        <span class="kr">const</span> <span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-192">        <span class="kr">const</span> <span class="nx">subOptions</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-193">            <span class="nx">remapInput</span><span class="o">:</span>  <span class="kc">false</span><span class="p">,</span>
</span><span id="line-194">            <span class="nx">remapOutput</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span id="line-195">        <span class="p">});</span>
</span><span id="line-196">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">subOptions</span> <span class="p">).</span><span class="nx">map</span><span class="p">(</span> <span class="nx">foundItem</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-197">            <span class="k">return</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span>
</span><span id="line-198">                <span class="nx">_id</span><span class="o">:</span> <span class="nx">foundItem</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
</span><span id="line-199">            <span class="p">},</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">subOptions</span> <span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">foundItem</span><span class="p">.</span><span class="nx">_id</span> <span class="p">));</span>
</span><span id="line-200">        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">updatedIds</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-201">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-202">                <span class="nx">_id</span><span class="o">:</span> <span class="p">{</span>
</span><span id="line-203">                    <span class="nx">$in</span><span class="o">:</span> <span class="nx">updatedIds</span><span class="p">,</span>
</span><span id="line-204">                <span class="p">},</span>
</span><span id="line-205">            <span class="p">},</span> <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span> <span class="nx">subOptions</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-206">                <span class="nx">remapOutput</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span id="line-207">            <span class="p">}));</span>
</span><span id="line-208">        <span class="p">});</span>
</span><span id="line-209">    <span class="p">}</span>
</span><span id="line-210">
</span><span id="line-211">
</span><span id="line-212"></pre></div></td></tr><tr class="section" id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><hr />

<h3>Delete</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-213">
</span><span id="line-214">
</span><span id="line-215"></pre></div></td></tr><tr class="section" id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>deleteOne</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#deleteOne}, modified for MongoDB.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Delete a single entity from the collection.</p></div><div class="dox_tag_title">In: <em>Adapters.MongoDiasporaAdapter</em></div><div class="dox_tag_title">See</div><div class="dox_tag_detail"><a href="#{tag.url"><http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#deleteOne> </http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#deleteOne></a></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the collection to delete data from</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing the entity to find</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once item is deleted. Called with (<em>undefined</em>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-216">    <span class="nx">deleteOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-217">        <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizeOptions</span><span class="p">(</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-218">        <span class="k">if</span> <span class="p">(</span> <span class="kc">true</span> <span class="o">===</span> <span class="nx">options</span><span class="p">.</span><span class="nx">remapInput</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-219">            <span class="nx">queryFind</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">remapInput</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span> <span class="p">);</span>
</span><span id="line-220">        <span class="p">}</span>
</span><span id="line-221">        <span class="nx">queryFind</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizeQuery</span><span class="p">(</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-222">        <span class="kr">const</span> <span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-223">        <span class="k">return</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">deleteOne</span><span class="p">(</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">results</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">());</span>
</span><span id="line-224">    <span class="p">}</span>
</span><span id="line-225">
</span><span id="line-226">
</span><span id="line-227"></pre></div></td></tr><tr class="section" id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>deleteMany</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#deleteMany}, modified for MongoDB.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Delete several entities from the collection.</p></div><div class="dox_tag_title">In: <em>Adapters.MongoDiasporaAdapter</em></div><div class="dox_tag_title">See</div><div class="dox_tag_detail"><a href="#{tag.url"><http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#deleteMany> </http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#deleteMany></a></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the collection to delete data from</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing the entity to find</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once item is deleted. Called with (<em>undefined</em>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-228">    <span class="nx">deleteMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-229">        <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizeOptions</span><span class="p">(</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-230">        <span class="nx">queryFind</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normalizeQuery</span><span class="p">(</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-231">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">found</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-232">            <span class="kr">const</span> <span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-233">            <span class="k">return</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({</span>
</span><span id="line-234">                <span class="nx">_id</span><span class="o">:</span> <span class="p">{</span>
</span><span id="line-235">                    <span class="nx">$in</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nx">found</span><span class="p">,</span> <span class="s1">&#39;_id&#39;</span> <span class="p">),</span>
</span><span id="line-236">                <span class="p">},</span>
</span><span id="line-237">            <span class="p">}).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">());</span>
</span><span id="line-238">        <span class="p">});</span>
</span><span id="line-239">    <span class="p">}</span>
</span><span id="line-240"><span class="p">}</span>
</span><span id="line-241">
</span><span id="line-242"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MongoDiasporaAdapter</span><span class="p">;</span>
</span>
</pre></div></td></tr></tbody></table></div>