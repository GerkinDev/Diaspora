---
layout: doccopage
title: "selenium.js"
toc: false
---
<div id="container"><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>selenium.js</h1><div class="filepath">test/browser/selenium.js</div></th><th class="code"></th></tr></thead><tbody><tr class="section" id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span></span><span id="line-1"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span id="line-2">
</span><span id="line-3">
</span><span id="line-4"></pre></div></td></tr><tr class="section" id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><div class="dox"><div class="summary"><p>globals l: false, it: false, describe: false, require: false, expect: false, beforeEach: false, afterEach: false</p></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-5">
</span><span id="line-6"><span class="kr">const</span> <span class="nx">webdriver</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;selenium-webdriver&#39;</span> <span class="p">);</span>
</span><span id="line-7"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;path&#39;</span> <span class="p">);</span>
</span><span id="line-8"><span class="kr">const</span> <span class="nx">chai</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;chai&#39;</span> <span class="p">);</span>
</span><span id="line-9"><span class="nx">global</span><span class="p">.</span><span class="nx">assert</span> <span class="o">=</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">assert</span><span class="p">;</span>
</span><span id="line-10"><span class="nx">global</span><span class="p">.</span><span class="nx">expect</span> <span class="o">=</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">expect</span><span class="p">;</span>
</span><span id="line-11">
</span><span id="line-12"><span class="kr">const</span> <span class="nx">getTestPath</span> <span class="o">=</span> <span class="nx">fileName</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-13">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">l</span><span class="p">.</span><span class="nx">isNil</span><span class="p">(</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SAUCE_USERNAME</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-14">        <span class="k">return</span> <span class="sb">`http://localhost:8000/test/browser/</span><span class="si">${</span> <span class="nx">fileName</span> <span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="line-15">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="line-16">        <span class="k">return</span> <span class="sb">`file://</span><span class="si">${</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="nx">fileName</span> <span class="p">)</span> <span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="line-17">    <span class="p">}</span>
</span><span id="line-18"><span class="p">};</span>
</span><span id="line-19"><span class="kr">const</span> <span class="nx">SauceLabs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;saucelabs&#39;</span> <span class="p">);</span>
</span><span id="line-20">
</span><span id="line-21"><span class="nx">describe</span><span class="p">(</span> <span class="sb">`Test Diaspora in the browser (</span><span class="si">${</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BROWSER_NAME</span> <span class="o">||</span> <span class="s1">&#39;chrome&#39;</span> <span class="si">}</span><span class="sb">)`</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">seleniumSuite</span><span class="p">()</span> <span class="p">{</span>
</span><span id="line-22">    <span class="k">this</span><span class="p">.</span><span class="nx">timeout</span><span class="p">(</span> <span class="mi">20000</span> <span class="p">);</span>
</span><span id="line-23">    <span class="kd">let</span> <span class="nx">browser</span><span class="p">;</span>
</span><span id="line-24">    <span class="kd">let</span> <span class="nx">passed</span><span class="p">;</span>
</span><span id="line-25">    <span class="kd">let</span> <span class="nx">saucelabs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SauceLabs</span><span class="p">({</span>
</span><span id="line-26">        <span class="nx">username</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SAUCE_USERNAME</span><span class="p">,</span>
</span><span id="line-27">        <span class="nx">password</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SAUCE_ACCESS_KEY</span><span class="p">,</span>
</span><span id="line-28">    <span class="p">});</span>
</span><span id="line-29">
</span><span id="line-30">    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-31">        <span class="nx">passed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span id="line-32">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">l</span><span class="p">.</span><span class="nx">isNil</span><span class="p">(</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SAUCE_USERNAME</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-33">            <span class="nx">browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
</span><span id="line-34">                <span class="p">.</span><span class="nx">usingServer</span><span class="p">(</span> <span class="sb">`http://</span><span class="si">${</span>  <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SAUCE_USERNAME</span>  <span class="si">}</span><span class="sb">:</span><span class="si">${</span>  <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SAUCE_ACCESS_KEY</span>  <span class="si">}</span><span class="sb">@ondemand.saucelabs.com:80/wd/hub`</span> <span class="p">)</span>
</span><span id="line-35">                <span class="p">.</span><span class="nx">withCapabilities</span><span class="p">({</span>
</span><span id="line-36">                    <span class="s1">&#39;tunnel-identifier&#39;</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TRAVIS_JOB_NUMBER</span><span class="p">,</span>
</span><span id="line-37">                    <span class="nx">build</span><span class="o">:</span>               <span class="sb">`Diaspora nÂ°</span><span class="si">${</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TRAVIS_BUILD_NUMBER</span> <span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="line-38">                    <span class="nx">username</span><span class="o">:</span>            <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SAUCE_USERNAME</span><span class="p">,</span>
</span><span id="line-39">                    <span class="nx">accessKey</span><span class="o">:</span>           <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SAUCE_ACCESS_KEY</span><span class="p">,</span>
</span><span id="line-40">                    <span class="nx">browserName</span><span class="o">:</span>         <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BROWSER_NAME</span><span class="p">,</span>
</span><span id="line-41">                <span class="p">}).</span><span class="nx">build</span><span class="p">();</span>
</span><span id="line-42">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="line-43">            <span class="nx">browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
</span><span id="line-44">                <span class="p">.</span><span class="nx">withCapabilities</span><span class="p">({</span>
</span><span id="line-45">                    <span class="nx">browserName</span><span class="o">:</span> <span class="s1">&#39;chrome&#39;</span><span class="p">,</span>
</span><span id="line-46">                <span class="p">}).</span><span class="nx">build</span><span class="p">();</span>
</span><span id="line-47">        <span class="p">}</span>
</span><span id="line-48">    <span class="p">});</span>
</span><span id="line-49">
</span><span id="line-50">    <span class="nx">afterEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-51">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">l</span><span class="p">.</span><span class="nx">isNil</span><span class="p">(</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SAUCE_USERNAME</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-52">            <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">getSession</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span> <span class="nx">session</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-53">                <span class="k">return</span> <span class="nx">saucelabs</span><span class="p">.</span><span class="nx">updateJob</span><span class="p">(</span> <span class="nx">session</span><span class="p">.</span><span class="nx">getId</span><span class="p">(),</span> <span class="p">{</span>
</span><span id="line-54">                    <span class="nx">passed</span><span class="p">,</span>
</span><span id="line-55">                    <span class="nx">name</span><span class="o">:</span> <span class="sb">`Diaspora Browser </span><span class="si">${</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">currentBuild</span> <span class="si">}</span><span class="sb"> build on </span><span class="si">${</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BROWSER_NAME</span> <span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="line-56">                <span class="p">});</span>
</span><span id="line-57">            <span class="p">}).</span><span class="k">catch</span><span class="p">(</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-58">                <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="nx">e</span> <span class="p">);</span>
</span><span id="line-59">                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">e</span> <span class="p">);</span>
</span><span id="line-60">            <span class="p">}).</span><span class="k">finally</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-61">                <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">quit</span><span class="p">();</span>
</span><span id="line-62">            <span class="p">});</span>
</span><span id="line-63">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="line-64">            <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">quit</span><span class="p">();</span>
</span><span id="line-65">        <span class="p">}</span>
</span><span id="line-66">    <span class="p">});</span>
</span><span id="line-67">
</span><span id="line-68">    <span class="nx">it</span><span class="p">(</span> <span class="s1">&#39;Standalone version should pass tests&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-69">        <span class="nx">browser</span><span class="p">.</span><span class="nx">currentBuild</span> <span class="o">=</span> <span class="s1">&#39;standalone&#39;</span><span class="p">;</span>
</span><span id="line-70">        <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="nx">getTestPath</span><span class="p">(</span> <span class="sb">`</span><span class="si">${</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">currentBuild</span>  <span class="si">}</span><span class="sb">.html`</span> <span class="p">)).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-71">            <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">findElements</span><span class="p">(</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">xpath</span><span class="p">(</span> <span class="s1">&#39;//*[@id=&quot;mocha-report&quot;]/*&#39;</span> <span class="p">));</span>
</span><span id="line-72">        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">reportChildren</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-73">            <span class="nx">expect</span><span class="p">(</span> <span class="nx">reportChildren</span> <span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">lengthOf</span><span class="p">.</span><span class="nx">above</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
</span><span id="line-74">            <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">findElements</span><span class="p">(</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">className</span><span class="p">(</span> <span class="s1">&#39;fail&#39;</span> <span class="p">));</span>
</span><span id="line-75">        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">failed</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-76">            <span class="nx">expect</span><span class="p">(</span> <span class="nx">failed</span> <span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">lengthOf</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
</span><span id="line-77">            <span class="nx">passed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span id="line-78">        <span class="p">});</span>
</span><span id="line-79">    <span class="p">});</span>
</span><span id="line-80">
</span><span id="line-81">    <span class="nx">it</span><span class="p">(</span> <span class="s1">&#39;Isolated version should pass tests&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-82">        <span class="nx">browser</span><span class="p">.</span><span class="nx">currentBuild</span> <span class="o">=</span> <span class="s1">&#39;isolated&#39;</span><span class="p">;</span>
</span><span id="line-83">        <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="nx">getTestPath</span><span class="p">(</span> <span class="sb">`</span><span class="si">${</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">currentBuild</span>  <span class="si">}</span><span class="sb">.html`</span> <span class="p">)).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-84">            <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">findElements</span><span class="p">(</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">xpath</span><span class="p">(</span> <span class="s1">&#39;//*[@id=&quot;mocha-report&quot;]/*&#39;</span> <span class="p">));</span>
</span><span id="line-85">        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">reportChildren</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-86">            <span class="nx">expect</span><span class="p">(</span> <span class="nx">reportChildren</span> <span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">lengthOf</span><span class="p">.</span><span class="nx">above</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
</span><span id="line-87">            <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">findElements</span><span class="p">(</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">className</span><span class="p">(</span> <span class="s1">&#39;fail&#39;</span> <span class="p">));</span>
</span><span id="line-88">        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">failed</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-89">            <span class="nx">expect</span><span class="p">(</span> <span class="nx">failed</span> <span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">lengthOf</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
</span><span id="line-90">            <span class="nx">passed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span id="line-91">        <span class="p">});</span>
</span><span id="line-92">    <span class="p">});</span>
</span><span id="line-93"><span class="p">});</span>
</span>
</pre></div></td></tr></tbody></table></div>