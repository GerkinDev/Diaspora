---
layout: doccopage
title: "inMemoryAdapter.js"
toc: false
---
<div id="container"><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>inMemoryAdapter.js</h1><div class="filepath">lib/adapters/inMemoryAdapter.js</div></th><th class="code"></th></tr></thead><tbody><tr class="section" id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span></span><span id="line-1"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span id="line-2">
</span><span id="line-3">
</span><span id="line-4"></pre></div></td></tr><tr class="section" id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><div class="dox"><div class="summary"><p>globals window: false</p></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-5">
</span><span id="line-6"><span class="kr">const</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;lodash&#39;</span> <span class="p">);</span>
</span><span id="line-7"><span class="kr">const</span> <span class="nb">Promise</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;bluebird&#39;</span> <span class="p">);</span>
</span><span id="line-8"><span class="kr">const</span> <span class="nx">DiasporaAdapter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;./baseAdapter.js&#39;</span> <span class="p">);</span>
</span><span id="line-9"><span class="kr">const</span> <span class="nx">InMemoryEntity</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;../dataStoreEntities/inMemoryEntity.js&#39;</span> <span class="p">);</span>
</span><span id="line-10">
</span><span id="line-11">
</span><span id="line-12"></pre></div></td></tr><tr class="section" id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Class <em>InMemoryDiasporaAdapter</em></div><div class="dox_tag_detail">This class is used to use the memory as a data store. Every data you insert are stored in an array contained by this class. This adapter can be used by both the browser & Node.JS</div><div class="dox_tag_title">extends</div><div class="dox_tag_detail">{&quot;type&quot;:&quot;extends&quot;,&quot;string&quot;:&quot;Adapters.DiasporaAdapter&quot;,&quot;otherClass&quot;:&quot;Adapters.DiasporaAdapter&quot;,&quot;html&quot;:&quot;&lt;p&gt;Adapters.DiasporaAdapter&lt;/p&gt;&quot;}</div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Create a new In Memory data store</p></div><div class="dox_tag_title">In: <em>Adapters</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>[config] </span><span class="dox_type">Object</span><span>- <p>Options hash. Currently, this adapter does not have any options</p></span></div><div class="dox_tag_title">Scope: <span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-13"><span class="kr">class</span> <span class="nx">InMemoryDiasporaAdapter</span> <span class="kr">extends</span> <span class="nx">DiasporaAdapter</span> <span class="p">{</span>
</span><span id="line-14">
</span><span id="line-15"></pre></div></td></tr><tr class="section" id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Create a new instance of in memory adapter</p></div><div class="dox_tag_title">constructs</div><div class="dox_tag_detail">{&quot;type&quot;:&quot;constructs&quot;,&quot;string&quot;:&quot;InMemoryDiasporaAdapter&quot;,&quot;html&quot;:&quot;&lt;p&gt;InMemoryDiasporaAdapter&lt;/p&gt;&quot;}</div><div class="dox_tag_title">In: <em>Adapters</em></div><div class="dox_tag_title">Scope: <span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-16">    <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
</span><span id="line-17">        <span class="kr">super</span><span class="p">(</span> <span class="nx">InMemoryEntity</span> <span class="p">);</span>
</span><span id="line-18">        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="s1">&#39;ready&#39;</span><span class="p">;</span>
</span><span id="line-19">        <span class="k">this</span><span class="p">.</span><span class="nx">store</span> <span class="o">=</span> <span class="p">{};</span>
</span><span id="line-20">    <span class="p">}</span>
</span><span id="line-21">
</span><span id="line-22">
</span><span id="line-23"></pre></div></td></tr><tr class="section" id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>configureCollection</em></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Create the data store and call {@link Adapters.DiasporaAdapter.configureCollection}</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>tableName </span><span class="dox_type">String</span><span>- <p>Name of the table (usually, model name)</p></span></div><div class="dox_tag_detail"> <span>remaps </span><span class="dox_type">Object</span><span>- <p>Associative hash that links entity field names with data source field names</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-24">    <span class="nx">configureCollection</span><span class="p">(</span> <span class="nx">tableName</span><span class="p">,</span> <span class="nx">remaps</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-25">        <span class="kr">super</span><span class="p">.</span><span class="nx">configureCollection</span><span class="p">(</span> <span class="nx">tableName</span><span class="p">,</span> <span class="nx">remaps</span> <span class="p">);</span>
</span><span id="line-26">        <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">tableName</span> <span class="p">);</span>
</span><span id="line-27">    <span class="p">}</span>
</span><span id="line-28">
</span><span id="line-29">
</span><span id="line-30"></pre></div></td></tr><tr class="section" id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><hr />

<h3>Utils</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-31">
</span><span id="line-32">
</span><span id="line-33"></pre></div></td></tr><tr class="section" id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>generateUUID</em></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Create a new unique id for this store's entity</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">String</span><span><p>Generated unique id</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-34">    <span class="nx">generateUUID</span><span class="p">()</span> <span class="p">{</span>
</span><span id="line-35">        <span class="kd">let</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
</span><span id="line-36">
</span><span id="line-37"></pre></div></td></tr><tr class="section" id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Use high-precision timer if available</p></td><td class="code"><div class="highlight"><pre></span><span id="line-38">        <span class="k">if</span> <span class="p">(</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nb">window</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">performance</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;function&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-39">            <span class="nx">d</span> <span class="o">+=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span><span id="line-40">        <span class="p">}</span>
</span><span id="line-41">        <span class="kr">const</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&#39;</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/[xy]/g</span><span class="p">,</span> <span class="nx">c</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-42">            <span class="kr">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">d</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">16</span> <span class="p">)</span> <span class="o">%</span> <span class="mi">16</span> <span class="o">|</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-43">            <span class="nx">d</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span> <span class="nx">d</span> <span class="o">/</span> <span class="mi">16</span> <span class="p">);</span>
</span><span id="line-44">            <span class="k">return</span> <span class="p">(</span> <span class="s1">&#39;x&#39;</span> <span class="o">===</span> <span class="nx">c</span> <span class="o">?</span> <span class="nx">r</span> <span class="o">:</span> <span class="p">(</span> <span class="nx">r</span> <span class="o">&amp;</span> <span class="mh">0x3</span> <span class="o">|</span> <span class="mh">0x8</span> <span class="p">)).</span><span class="nx">toString</span><span class="p">(</span> <span class="mi">16</span> <span class="p">);</span>
</span><span id="line-45">        <span class="p">});</span>
</span><span id="line-46">        <span class="k">return</span> <span class="nx">uuid</span><span class="p">;</span>
</span><span id="line-47">    <span class="p">}</span>
</span><span id="line-48">
</span><span id="line-49">
</span><span id="line-50"></pre></div></td></tr><tr class="section" id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>ensureCollectionExists</em></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Get or create the store hash</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the table</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">DataStoreTable</span><span><p>In memory table to use</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-51">    <span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-52">        <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span> <span class="nx">table</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-53">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">[</span><span class="nx">table</span><span class="p">];</span>
</span><span id="line-54">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="line-55">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">[</span><span class="nx">table</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-56">                <span class="nx">items</span><span class="o">:</span> <span class="p">[],</span>
</span><span id="line-57">            <span class="p">};</span>
</span><span id="line-58">        <span class="p">}</span> 
</span><span id="line-59">    <span class="p">}</span>
</span><span id="line-60">
</span><span id="line-61">
</span><span id="line-62"></pre></div></td></tr><tr class="section" id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>applyOptionsToSet</em></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Reduce, offset or sort provided set</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>set </span><span class="dox_type">Array.&lt;Object&gt;</span><span>- <p>Objects retrieved from memory store</p></span></div><div class="dox_tag_detail"> <span>options </span><span class="dox_type">Object</span><span>- <p>Options to apply to the set</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Array.&lt;Object&gt;</span><span><p>Set with options applied</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-63">    <span class="kr">static</span> <span class="nx">applyOptionsToSet</span><span class="p">(</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-64">        <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-65">            <span class="nx">limit</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
</span><span id="line-66">            <span class="nx">skip</span><span class="o">:</span>  <span class="mi">0</span><span class="p">,</span>
</span><span id="line-67">        <span class="p">});</span>
</span><span id="line-68">        <span class="nx">set</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">skip</span> <span class="p">);</span>
</span><span id="line-69">        <span class="k">if</span> <span class="p">(</span> <span class="nx">set</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">limit</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-70">            <span class="nx">set</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">limit</span> <span class="p">);</span>
</span><span id="line-71">        <span class="p">}</span>
</span><span id="line-72">        <span class="k">return</span> <span class="nx">set</span><span class="p">;</span>
</span><span id="line-73">    <span class="p">}</span>
</span><span id="line-74">
</span><span id="line-75">
</span><span id="line-76"></pre></div></td></tr><tr class="section" id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><hr />

<h3>Insert</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-77">
</span><span id="line-78">
</span><span id="line-79"></pre></div></td></tr><tr class="section" id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>insertOne</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#insertOne}, modified for in-memory interactions.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Insert a single entity in the memory store.</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the table to insert data in</p></span></div><div class="dox_tag_detail"> <span>entity </span><span class="dox_type">Object</span><span>- <p>Hash representing the entity to insert</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once insertion is done. Called with (<em>{@link InMemoryEntity}</em> <code>entity</code>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-80">    <span class="nx">insertOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">entity</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-81">        <span class="nx">entity</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">);</span>
</span><span id="line-82">        <span class="kr">const</span> <span class="nx">storeTable</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-83">        <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateUUID</span><span class="p">();</span>
</span><span id="line-84">        <span class="k">this</span><span class="p">.</span><span class="nx">setIdHash</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">);</span>
</span><span id="line-85">        <span class="nx">storeTable</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">);</span>
</span><span id="line-86">        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">classEntity</span><span class="p">(</span> <span class="nx">entity</span><span class="p">,</span> <span class="k">this</span> <span class="p">));</span>
</span><span id="line-87">    <span class="p">}</span>
</span><span id="line-88">
</span><span id="line-89">
</span><span id="line-90"></pre></div></td></tr><tr class="section" id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><hr />

<h3>Find</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-91">
</span><span id="line-92">
</span><span id="line-93"></pre></div></td></tr><tr class="section" id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>findOne</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#findOne}, modified for in-memory interactions.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Retrieve a single entity from the memory.</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the table to retrieve data from</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing the entity to find</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once item is found. Called with (<em>{@link InMemoryEntity}</em> <code>entity</code>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-94">    <span class="nx">findOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-95">        <span class="kr">const</span> <span class="nx">storeTable</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-96">        <span class="kr">const</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span> <span class="nx">storeTable</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">partial</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">matchEntity</span><span class="p">,</span> <span class="nx">queryFind</span> <span class="p">));</span>
</span><span id="line-97">        <span class="kr">const</span> <span class="nx">reducedMatches</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">applyOptionsToSet</span><span class="p">(</span> <span class="nx">matches</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-98">        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">reducedMatches</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">classEntity</span><span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span> <span class="nx">reducedMatches</span> <span class="p">),</span> <span class="k">this</span> <span class="p">)</span> <span class="o">:</span> <span class="kc">undefined</span> <span class="p">);</span>
</span><span id="line-99">    <span class="p">}</span>
</span><span id="line-100">
</span><span id="line-101">
</span><span id="line-102"></pre></div></td></tr><tr class="section" id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>findMany</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#findMany}, modified for in-memory interactions.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Retrieve several entities from the memory.</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the table to retrieve data from</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing entities to find</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once items are found. Called with (<em>{@link InMemoryEntity}[]</em> <code>entities</code>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-103">    <span class="nx">findMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-104">        <span class="kr">const</span> <span class="nx">storeTable</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-105">        <span class="kr">const</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span> <span class="nx">storeTable</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">partial</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">matchEntity</span><span class="p">,</span> <span class="nx">queryFind</span> <span class="p">));</span>
</span><span id="line-106">        <span class="kr">const</span> <span class="nx">reducedMatches</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">applyOptionsToSet</span><span class="p">(</span> <span class="nx">matches</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
</span><span id="line-107">        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nx">reducedMatches</span><span class="p">,</span> <span class="nx">entity</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">classEntity</span><span class="p">(</span> <span class="nx">entity</span><span class="p">,</span> <span class="k">this</span> <span class="p">)));</span>
</span><span id="line-108">    <span class="p">}</span>
</span><span id="line-109">
</span><span id="line-110">
</span><span id="line-111"></pre></div></td></tr><tr class="section" id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><hr />

<h3>Update</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-112">
</span><span id="line-113">
</span><span id="line-114"></pre></div></td></tr><tr class="section" id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>updateOne</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#updateOne}, modified for in-memory interactions.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Update a single entity in the memory.</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the table to update data in</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing the entity to find</p></span></div><div class="dox_tag_detail"> <span>update </span><span class="dox_type">Object</span><span>- <p>Object properties to set</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once update is done. Called with (<em>{@link InMemoryEntity}</em> <code>entity</code>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-115">    <span class="nx">updateOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-116">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">found</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-117">            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isNil</span><span class="p">(</span> <span class="nx">found</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-118">                <span class="kr">const</span> <span class="nx">storeTable</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-119">                <span class="kr">const</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="nx">storeTable</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-120">                    <span class="nx">id</span><span class="o">:</span> <span class="nx">found</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
</span><span id="line-121">                <span class="p">});</span>
</span><span id="line-122">                <span class="k">this</span><span class="p">.</span><span class="nx">applyUpdateEntity</span><span class="p">(</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">match</span> <span class="p">);</span>
</span><span id="line-123">                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">classEntity</span><span class="p">(</span> <span class="nx">match</span><span class="p">,</span> <span class="k">this</span> <span class="p">));</span>
</span><span id="line-124">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="line-125">                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span id="line-126">            <span class="p">}</span>
</span><span id="line-127">        <span class="p">});</span>
</span><span id="line-128">    <span class="p">}</span>
</span><span id="line-129">
</span><span id="line-130">
</span><span id="line-131"></pre></div></td></tr><tr class="section" id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>updateMany</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#updateMany}, modified for in-memory interactions.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Update several entities in the memory.</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the table to update data in</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing entities to find</p></span></div><div class="dox_tag_detail"> <span>update </span><span class="dox_type">Object</span><span>- <p>Object properties to set</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once update is done. Called with (<em>{@link InMemoryEntity}[]</em> <code>entities</code>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-132">    <span class="nx">updateMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-133">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">found</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-134">            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isNil</span><span class="p">(</span> <span class="nx">found</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">found</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-135">                <span class="kr">const</span> <span class="nx">storeTable</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-136">                <span class="kr">const</span> <span class="nx">foundIds</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nx">found</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span> <span class="p">);</span>
</span><span id="line-137">                <span class="kr">const</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span> <span class="nx">storeTable</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span> <span class="nx">item</span> <span class="p">=&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">!==</span> <span class="nx">foundIds</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span> <span class="p">));</span>
</span><span id="line-138">                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx"</pre></div></td></tr><tr class="section" id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><hr />

<h3>Delete</h3></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr class="section" id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>deleteOne</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#deleteOne}, modified for in-memory interactions.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Delete a single entity from the memory.</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the table to delete data from</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing the entity to find</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once item is found. Called with (<em>undefined</em>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr class="section" id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Method <em>deleteMany</em></div><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#deleteMany}, modified for in-memory interactions.</p></div><div class="dox_tag_title">Description:</div><div class="dox_tag_detail"><p>Delete several entities from the memory.</p></div><div class="dox_tag_title">In: <em>Adapters.InMemoryDiasporaAdapter</em></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">String</span><span>- <p>Name of the table to delete data from</p></span></div><div class="dox_tag_detail"> <span>queryFind </span><span class="dox_type">SelectQueryOrCondition</span><span>- <p>Hash representing entities to find</p></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span class="dox_type">QueryOptions</span><span>- <p>Hash of options.</p></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once items are deleted. Called with (<em>undefined</em>)</p></span></div><div class="dox_tag_title">Scope: <span class="object">instance</span><span class="modifier">public</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr></tbody></table></div>