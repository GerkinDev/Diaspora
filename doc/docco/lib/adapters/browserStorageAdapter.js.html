---
layout: doccopage
title: "browserStorageAdapter.js"
toc: false
---
<div id="container"><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>browserStorageAdapter.js</h1><div class="filepath">lib/adapters/browserStorageAdapter.js</div></th><th class="code"></th></tr></thead><tbody><tr class="section" id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span></span><span id="line-1"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span id="line-2">
</span><span id="line-3"><span class="kr">const</span> <span class="p">{</span>
</span><span id="line-4">    <span class="nx">_</span><span class="p">,</span> <span class="nb">Promise</span><span class="p">,</span>
</span><span id="line-5"><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;../dependencies&#39;</span> <span class="p">);</span>
</span><span id="line-6"><span class="kr">const</span> <span class="nx">DiasporaAdapter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;./baseAdapter.js&#39;</span> <span class="p">);</span>
</span><span id="line-7"><span class="kr">const</span> <span class="nx">BrowserStorageEntity</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;../dataStoreEntities/browserStorageEntity.js&#39;</span> <span class="p">);</span>
</span><span id="line-8">
</span><span id="line-9">
</span><span id="line-10"></pre></div></td></tr><tr class="section" id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">extends</div><div class="dox_tag_detail">{&quot;type&quot;:&quot;extends&quot;,&quot;string&quot;:&quot;Adapters.DiasporaAdapter&quot;,&quot;otherClass&quot;:&quot;Adapters.DiasporaAdapter&quot;,&quot;html&quot;:&quot;&lt;p&gt;Adapters.DiasporaAdapter&lt;/p&gt;&quot;}</div><div class="dox_tag_title">In: <em>Adapters</em></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-11"><span class="kr">class</span> <span class="nx">BrowserStorageDiasporaAdapter</span> <span class="kr">extends</span> <span class="nx">DiasporaAdapter</span> <span class="p">{</span>
</span><span id="line-12">
</span><span id="line-13"></pre></div></td></tr><tr class="section" id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>config </span><span class="dox_type">Object</span><span>- <ul>
<li>Configuration object.</li>
</ul></span></div><div class="dox_tag_detail"> <span>[config.session=false] </span><span class="dox_type">boolean</span><span>- <ul>
<li>Set to true to use sessionStorage instead of localStorage.</li>
</ul></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-14">    <span class="nx">constructor</span><span class="p">(</span> <span class="nx">config</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-15">
</span><span id="line-16"></pre></div></td></tr><tr class="section" id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">name</div><div class="dox_tag_detail">{&quot;type&quot;:&quot;name&quot;,&quot;string&quot;:&quot;classEntity&quot;,&quot;html&quot;:&quot;&lt;p&gt;classEntity&lt;/p&gt;&quot;}</div><div class="dox_tag_title">Type</div><div class="dox_tag_detail"><span class="dox_type">DataStoreEntities.BrowserStorageEntity</span></div><div class="dox_tag_title">In: <em>Adapters.BrowserStorageDiasporaAdapter</em></div><div class="dox_tag_title">Scope: <span class="object">instance</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><Gerkin></Gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-17">        <span class="kr">super</span><span class="p">(</span> <span class="nx">BrowserStorageEntity</span> <span class="p">);</span>
</span><span id="line-18">        <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span> <span class="nx">config</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-19">            <span class="nx">session</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span id="line-20">        <span class="p">});</span>
</span><span id="line-21">        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="s1">&#39;ready&#39;</span><span class="p">;</span>
</span><span id="line-22">
</span><span id="line-23"></pre></div></td></tr><tr class="section" id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Type</div><div class="dox_tag_detail"><span class="dox_type">Storage</span></div><div class="dox_tag_title">See</div><div class="dox_tag_detail"><a href="#{tag.url"><{@link https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage localStorage}></{@link https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage localStorage}></a></div><div class="dox_tag_title">See</div><div class="dox_tag_detail"><span class="dox_type">{@link Adapters.BrowserStorageDiasporaAdapter}:config.session parameter.</span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><Gerkin></Gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-24">        <span class="k">this</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="p">(</span> <span class="kc">true</span> <span class="o">===</span> <span class="nx">config</span><span class="p">.</span><span class="nx">session</span> <span class="o">?</span> <span class="nx">global</span><span class="p">.</span><span class="nx">sessionStorage</span> <span class="o">:</span> <span class="nx">global</span><span class="p">.</span><span class="nx">localStorage</span> <span class="p">);</span>
</span><span id="line-25">    <span class="p">}</span>
</span><span id="line-26">
</span><span id="line-27">
</span><span id="line-28"></pre></div></td></tr><tr class="section" id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>tableName </span><span class="dox_type">string</span><span>- <ul>
<li>Name of the table (usually, model name).</li>
</ul></span></div><div class="dox_tag_detail"> <span>remaps </span><span class="dox_type">Object</span><span>- <ul>
<li>Associative hash that links entity field names with data source field names.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span><p>This function does not return anything.</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-29">    <span class="nx">configureCollection</span><span class="p">(</span> <span class="nx">tableName</span><span class="p">,</span> <span class="nx">remaps</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-30">        <span class="kr">super</span><span class="p">.</span><span class="nx">configureCollection</span><span class="p">(</span> <span class="nx">tableName</span><span class="p">,</span> <span class="nx">remaps</span> <span class="p">);</span>
</span><span id="line-31">        <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">tableName</span> <span class="p">);</span>
</span><span id="line-32">    <span class="p">}</span>
</span><span id="line-33">
</span><span id="line-34">
</span><span id="line-35"></pre></div></td></tr><tr class="section" id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><hr />

<h3>Utils</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-36">
</span><span id="line-37">
</span><span id="line-38"></pre></div></td></tr><tr class="section" id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">string</span><span><p>Generated unique id.</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-39">    <span class="nx">generateUUID</span><span class="p">()</span> <span class="p">{</span>
</span><span id="line-40">        <span class="kd">let</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
</span><span id="line-41">        <span class="k">if</span> <span class="p">(</span> <span class="nx">global</span><span class="p">.</span><span class="nx">performance</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;function&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">global</span><span class="p">.</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-42">            <span class="nx">d</span> <span class="o">+=</span> <span class="nx">global</span><span class="p">.</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span> <span class="c1">//use high-precision timer if available</span>
</span><span id="line-43">        <span class="p">}</span>
</span><span id="line-44">        <span class="kr">const</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&#39;</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/[xy]/g</span><span class="p">,</span> <span class="nx">c</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-45">            <span class="kr">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">d</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">16</span> <span class="p">)</span> <span class="o">%</span> <span class="mi">16</span> <span class="o">|</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-46">            <span class="nx">d</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span> <span class="nx">d</span> <span class="o">/</span> <span class="mi">16</span> <span class="p">);</span>
</span><span id="line-47">            <span class="k">return</span> <span class="p">(</span> <span class="s1">&#39;x&#39;</span> <span class="o">===</span> <span class="nx">c</span> <span class="o">?</span> <span class="nx">r</span> <span class="o">:</span> <span class="p">(</span> <span class="nx">r</span> <span class="o">&amp;</span> <span class="mh">0x3</span> <span class="o">|</span> <span class="mh">0x8</span> <span class="p">)).</span><span class="nx">toString</span><span class="p">(</span> <span class="mi">16</span> <span class="p">);</span>
</span><span id="line-48">        <span class="p">});</span>
</span><span id="line-49">        <span class="k">return</span> <span class="nx">uuid</span><span class="p">;</span>
</span><span id="line-50">    <span class="p">}</span>
</span><span id="line-51">
</span><span id="line-52">
</span><span id="line-53"></pre></div></td></tr><tr class="section" id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">string</span><span>- <ul>
<li>Name of the table.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Array.&lt;string&gt;</span><span><p>Index of the collection.</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-54">    <span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-55">        <span class="kd">let</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-56">        <span class="k">if</span> <span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNil</span><span class="p">(</span> <span class="nx">index</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-57">            <span class="nx">index</span> <span class="o">=</span> <span class="p">[];</span>
</span><span id="line-58">            <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">index</span> <span class="p">));</span>
</span><span id="line-59">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="line-60">            <span class="nx">index</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span> <span class="nx">index</span> <span class="p">);</span>
</span><span id="line-61">        <span class="p">}</span>
</span><span id="line-62">        <span class="k">return</span> <span class="nx">index</span><span class="p">;</span>
</span><span id="line-63">    <span class="p">}</span>
</span><span id="line-64">
</span><span id="line-65">
</span><span id="line-66"></pre></div></td></tr><tr class="section" id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>set </span><span class="dox_type">Array.&lt;Object&gt;</span><span>- <ul>
<li>Objects retrieved from memory store.</li>
</ul></span></div><div class="dox_tag_detail"> <span>options </span><span class="dox_type">Object</span><span>- <ul>
<li>Options to apply to the set.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Array.&lt;Object&gt;</span><span><p>Set with options applied.</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-67">    <span class="kr">static</span> <span class="nx">applyOptionsToSet</span><span class="p">(</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-68">        <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-69">            <span class="nx">limit</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
</span><span id="line-70">            <span class="nx">skip</span><span class="o">:</span>  <span class="mi">0</span><span class="p">,</span>
</span><span id="line-71">        <span class="p">});</span>
</span><span id="line-72">        <span class="nx">set</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">skip</span> <span class="p">);</span>
</span><span id="line-73">        <span class="k">if</span> <span class="p">(</span> <span class="nx">set</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">limit</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-74">            <span class="nx">set</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">limit</span> <span class="p">);</span>
</span><span id="line-75">        <span class="p">}</span>
</span><span id="line-76">        <span class="k">return</span> <span class="nx">set</span><span class="p">;</span>
</span><span id="line-77">    <span class="p">}</span>
</span><span id="line-78">
</span><span id="line-79">
</span><span id="line-80"></pre></div></td></tr><tr class="section" id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">string</span><span>- <ul>
<li>Name of the table to construct name for.</li>
</ul></span></div><div class="dox_tag_detail"> <span>id </span><span class="dox_type">string</span><span>- <ul>
<li>Id of the item to find.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">string</span><span><p>Name of the item.</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-81">    <span class="nx">getItemName</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">id</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-82">        <span class="k">return</span> <span class="sb">`</span><span class="si">${</span> <span class="nx">table</span> <span class="si">}</span><span class="sb">.id=</span><span class="si">${</span> <span class="nx">id</span> <span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="line-83">    <span class="p">}</span>
</span><span id="line-84">
</span><span id="line-85">
</span><span id="line-86"></pre></div></td></tr><tr class="section" id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><hr />

<h3>Insert</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-87">
</span><span id="line-88">
</span><span id="line-89"></pre></div></td></tr><tr class="section" id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#insertOne}, modified for local storage or session storage interactions.</p></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">string</span><span>- <ul>
<li>Name of the table to insert data in.</li>
</ul></span></div><div class="dox_tag_detail"> <span>entity </span><span class="dox_type">Object</span><span>- <ul>
<li>Hash representing the entity to insert.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once insertion is done. Called with (<em>{@link DataStoreEntities.BrowserStorageEntity}</em> <code>entity</code>).</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-90">    <span class="nx">insertOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">entity</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-91">        <span class="nx">entity</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span> <span class="nx">entity</span> <span class="o">||</span> <span class="p">{});</span>
</span><span id="line-92">        <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateUUID</span><span class="p">();</span>
</span><span id="line-93">        <span class="k">this</span><span class="p">.</span><span class="nx">setIdHash</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">);</span>
</span><span id="line-94">        <span class="k">try</span> <span class="p">{</span>
</span><span id="line-95">            <span class="kr">const</span> <span class="nx">tableIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-96">            <span class="nx">tableIndex</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span> <span class="p">);</span>
</span><span id="line-97">            <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">tableIndex</span> <span class="p">));</span>
</span><span id="line-98">            <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItemName</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span> <span class="p">),</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">));</span>
</span><span id="line-99">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-100">            <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span>
</span><span id="line-101">        <span class="p">}</span>
</span><span id="line-102">        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">classEntity</span><span class="p">(</span> <span class="nx">entity</span><span class="p">,</span> <span class="k">this</span> <span class="p">));</span>
</span><span id="line-103">    <span class="p">}</span>
</span><span id="line-104">
</span><span id="line-105">
</span><span id="line-106"></pre></div></td></tr><tr class="section" id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#insertMany}, modified for local storage or session storage interactions.</p></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">string</span><span>- <ul>
<li>Name of the table to insert data in.</li>
</ul></span></div><div class="dox_tag_detail"> <span>entities </span><span class="dox_type">Array.&lt;Object&gt;</span><span>- <ul>
<li>Array of hashes representing entities to insert.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once insertion is done. Called with (<em>{@link DataStoreEntities.BrowserStorageEntity}[]</em> <code>entities</code>).</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-107">    <span class="nx">insertMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">entities</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-108">        <span class="nx">entities</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span> <span class="nx">entities</span> <span class="p">);</span>
</span><span id="line-109">        <span class="k">try</span> <span class="p">{</span>
</span><span id="line-110">            <span class="kr">const</span> <span class="nx">tableIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-111">            <span class="nx">entities</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span> <span class="nx">entity</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-112">                <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateUUID</span><span class="p">();</span>
</span><span id="line-113">                <span class="k">this</span><span class="p">.</span><span class="nx">setIdHash</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">);</span>
</span><span id="line-114">                <span class="nx">tableIndex</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span> <span class="p">);</span>
</span><span id="line-115">                <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItemName</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span> <span class="p">),</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">));</span>
</span><span id="line-116">                <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">classEntity</span><span class="p">(</span> <span class="nx">entity</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
</span><span id="line-117">            <span class="p">});</span>
</span><span id="line-118">            <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">tableIndex</span> <span class="p">));</span>
</span><span id="line-119">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-120">            <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span>
</span><span id="line-121">        <span class="p">}</span>
</span><span id="line-122">        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">entities</span> <span class="p">);</span>
</span><span id="line-123">    <span class="p">}</span>
</span><span id="line-124">
</span><span id="line-125">
</span><span id="line-126"></pre></div></td></tr><tr class="section" id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><hr />

<h3>Find</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-127">
</span><span id="line-128">
</span><span id="line-129"></pre></div></td></tr><tr class="section" id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">string</span><span>- <ul>
<li>Name of the collection to search entity in.</li>
</ul></span></div><div class="dox_tag_detail"> <span>id </span><span class="dox_type">string</span><span>- <ul>
<li>Id of the entity to search.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">DataStoreEntities.BrowserStorageEntity</span><span><p>Found entity, or undefined if not found.</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-130">    <span class="nx">findOneById</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">id</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-131">        <span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItemName</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">id</span> <span class="p">));</span>
</span><span id="line-132">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isNil</span><span class="p">(</span> <span class="nx">item</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-133">            <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">classEntity</span><span class="p">(</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span> <span class="nx">item</span> <span class="p">),</span> <span class="k">this</span> <span class="p">));</span>
</span><span id="line-134">        <span class="p">}</span>
</span><span id="line-135">        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span id="line-136">    <span class="p">}</span>
</span><span id="line-137">
</span><span id="line-138">
</span><span id="line-139"></pre></div></td></tr><tr class="section" id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#findOne}, modified for local storage or session storage interactions.</p></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">string</span><span>- <ul>
<li>Name of the model to retrieve data from.</li>
</ul></span></div><div class="dox_tag_detail"> <span>queryFind </span><span>- <ul>
<li>Hash representing the entity to find.</li>
</ul></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span>- <ul>
<li>Hash of options.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once item is found. Called with (<em>{@link DataStoreEntities.BrowserStorageEntity}</em> <code>entity</code>).</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-140">    <span class="nx">findOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-141">        <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-142">            <span class="nx">skip</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="line-143">        <span class="p">});</span>
</span><span id="line-144">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span> <span class="nx">queryFind</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-145">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findOneById</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span> <span class="p">);</span>
</span><span id="line-146">        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span> <span class="nx">queryFind</span> <span class="p">),</span> <span class="p">[</span> <span class="s1">&#39;id&#39;</span> <span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span> <span class="nx">queryFind</span><span class="p">.</span><span class="nx">id</span> <span class="p">),</span> <span class="p">[</span> <span class="s1">&#39;$equal&#39;</span> <span class="p">]))</span> <span class="p">{</span>
</span><span id="line-147">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findOneById</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">$equal</span> <span class="p">);</span>
</span><span id="line-148">        <span class="p">}</span>
</span><span id="line-149">        <span class="kr">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-150">        <span class="kd">let</span> <span class="nx">returnedItem</span><span class="p">;</span>
</span><span id="line-151">        <span class="kd">let</span> <span class="nx">matched</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-152">        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">itemId</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-153">            <span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItemName</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">itemId</span> <span class="p">)));</span>
</span><span id="line-154">            <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">matchEntity</span><span class="p">(</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">item</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-155">                <span class="nx">matched</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-156">
</span><span id="line-157"></pre></div></td></tr><tr class="section" id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>If we matched enough items</p></td><td class="code"><div class="highlight"><pre></span><span id="line-158">                <span class="k">if</span> <span class="p">(</span> <span class="nx">matched</span> <span class="o">&gt;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">skip</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-159">                    <span class="nx">returnedItem</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
</span><span id="line-160">                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span id="line-161">                <span class="p">}</span>
</span><span id="line-162">            <span class="p">}</span>
</span><span id="line-163">        <span class="p">});</span>
</span><span id="line-164">        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isNil</span><span class="p">(</span> <span class="nx">returnedItem</span> <span class="p">)</span> <span class="o">?</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">classEntity</span><span class="p">(</span> <span class="nx">returnedItem</span><span class="p">,</span> <span class="k">this</span> <span class="p">)</span> <span class="o">:</span> <span class="kc">undefined</span> <span class="p">);</span>
</span><span id="line-165">    <span class="p">}</span>
</span><span id="line-166">
</span><span id="line-167">
</span><span id="line-168"></pre></div></td></tr><tr class="section" id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><hr />

<h3>Update</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-169">
</span><span id="line-170">
</span><span id="line-171"></pre></div></td></tr><tr class="section" id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#updateOne}, modified for local storage or session storage interactions.</p></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">string</span><span>- <ul>
<li>Name of the table to update data in.</li>
</ul></span></div><div class="dox_tag_detail"> <span>queryFind </span><span>- <ul>
<li>Hash representing the entity to find.</li>
</ul></span></div><div class="dox_tag_detail"> <span>update </span><span class="dox_type">Object</span><span>- <ul>
<li>Object properties to set.</li>
</ul></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span>- <ul>
<li>Hash of options.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once update is done. Called with (<em>{@link DataStoreEntities.BrowserStorageEntity}</em> <code>entity</code>).</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-172">    <span class="nx">updateOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-173">        <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span>
</span><span id="line-174">            <span class="nx">skip</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="line-175">        <span class="p">});</span>
</span><span id="line-176">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-177">            <span class="k">if</span> <span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNil</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">))</span> <span class="p">{</span>
</span><span id="line-178">                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span id="line-179">            <span class="p">}</span>
</span><span id="line-180">            <span class="k">this</span><span class="p">.</span><span class="nx">applyUpdateEntity</span><span class="p">(</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">entity</span> <span class="p">);</span>
</span><span id="line-181">            <span class="k">try</span> <span class="p">{</span>
</span><span id="line-182">                <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItemName</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span> <span class="p">),</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">));</span>
</span><span id="line-183">                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">entity</span> <span class="p">);</span>
</span><span id="line-184">            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-185">                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span>
</span><span id="line-186">            <span class="p">}</span>
</span><span id="line-187">        <span class="p">});</span>
</span><span id="line-188">    <span class="p">}</span>
</span><span id="line-189">
</span><span id="line-190">
</span><span id="line-191"></pre></div></td></tr><tr class="section" id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><hr />

<h3>Delete</h3></td><td class="code"><div class="highlight"><pre></span><span id="line-192">
</span><span id="line-193">
</span><span id="line-194"></pre></div></td></tr><tr class="section" id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#deleteOne}, modified for local storage or session storage interactions.</p></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">string</span><span>- <ul>
<li>Name of the table to delete data from.</li>
</ul></span></div><div class="dox_tag_detail"> <span>queryFind </span><span>- <ul>
<li>Hash representing the entity to find.</li>
</ul></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span>- <ul>
<li>Hash of options.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once item is deleted. Called with (<em>undefined</em>).</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-195">    <span class="nx">deleteOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-196">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">entityToDelete</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-197">            <span class="k">try</span> <span class="p">{</span>
</span><span id="line-198">                <span class="kr">const</span> <span class="nx">tableIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-199">                <span class="nx">_</span><span class="p">.</span><span class="nx">pull</span><span class="p">(</span> <span class="nx">tableIndex</span><span class="p">,</span> <span class="nx">entityToDelete</span><span class="p">.</span><span class="nx">id</span> <span class="p">);</span>
</span><span id="line-200">                <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">tableIndex</span> <span class="p">));</span>
</span><span id="line-201">                <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItemName</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">entityToDelete</span><span class="p">.</span><span class="nx">id</span> <span class="p">));</span>
</span><span id="line-202">            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-203">                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span>
</span><span id="line-204">            <span class="p">}</span>
</span><span id="line-205">            <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span id="line-206">        <span class="p">});</span>
</span><span id="line-207">    <span class="p">}</span>
</span><span id="line-208">
</span><span id="line-209">
</span><span id="line-210"></pre></div></td></tr><tr class="section" id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><div class="dox"><div class="details"><div class="dox_tag_title">Summary:</div><div class="dox_tag_detail"><p>This reimplements {@link Adapters.DiasporaAdapter#deleteMany}, modified for local storage or session storage interactions.</p></div><div class="dox_tag_title">Params</div><div class="dox_tag_detail"> <span>table </span><span class="dox_type">string</span><span>- <ul>
<li>Name of the table to delete data from.</li>
</ul></span></div><div class="dox_tag_detail"> <span>queryFind </span><span>- <ul>
<li>Hash representing entities to find.</li>
</ul></span></div><div class="dox_tag_detail"> <span>[options={}] </span><span>- <ul>
<li>Hash of options.</li>
</ul></span></div><div class="dox_tag_title">Returns</div><div class="dox_tag_detail"><span class="dox_type">Promise</span><span><p>Promise resolved once items are deleted. Called with (<em>undefined</em>).</p></span></div><div class="dox_tag_title">Author</div><div class="dox_tag_detail"><gerkin></gerkin></div></div><div class="body"></div></div></td><td class="code"><div class="highlight"><pre></span><span id="line-211">    <span class="nx">deleteMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
</span><span id="line-212">        <span class="k">try</span> <span class="p">{</span>
</span><span id="line-213">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findMany</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">queryFind</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">entitiesToDelete</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-214">                <span class="kr">const</span> <span class="nx">tableIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ensureCollectionExists</span><span class="p">(</span> <span class="nx">table</span> <span class="p">);</span>
</span><span id="line-215">                <span class="nx">_</span><span class="p">.</span><span class="nx">pullAll</span><span class="p">(</span> <span class="nx">tableIndex</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nx">entitiesToDelete</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span> <span class="p">));</span>
</span><span id="line-216">                <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">tableIndex</span> <span class="p">));</span>
</span><span id="line-217">                <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="nx">entitiesToDelete</span><span class="p">,</span> <span class="nx">entityToDelete</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span id="line-218">                    <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItemName</span><span class="p">(</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">entityToDelete</span><span class="p">.</span><span class="nx">id</span> <span class="p">));</span>
</span><span id="line-219">                <span class="p">});</span>
</span><span id="line-220">                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span id="line-221">            <span class="p">});</span>
</span><span id="line-222">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
</span><span id="line-223">            <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span>
</span><span id="line-224">        <span class="p">}</span>
</span><span id="line-225">    <span class="p">}</span>
</span><span id="line-226"><span class="p">}</span>
</span><span id="line-227">
</span><span id="line-228"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">BrowserStorageDiasporaAdapter</span><span class="p">;</span>
</span>
</pre></div></td></tr></tbody></table></div>